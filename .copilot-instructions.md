# Copilot Instructions for vggt-dataset-builder

## Running Python Code

**IMPORTANT:** This repository uses `uv` for dependency management and Python execution. **Always use `uv run` when executing any Python code.**

### General Rule
```bash
# ✅ CORRECT - Always use this
uv run <command>

# ❌ WRONG - Don't use these
python <command>
python3 <command>
</command>

# Examples
uv run python script.py
uv run pytest tests/
uv run python -m pytest tests/test_triplet_detection.py -v
uv run python -c "some code"
```

### Common Tasks

**Running tests:**
```bash
uv run pytest tests/
uv run pytest tests/test_triplet_detection.py -v
```

**Running scripts:**
```bash
uv run python build_warp_dataset.py --input-dir input --output-dir output
uv run python aitoolkit-dataset.py --output-dir output --aitoolkit-dir aitoolkit-dataset
uv run python modelscope-dataset.py --output-dir output --modelscope-dir modelscope-dataset
uv run python vggt_point_cloud_viewer.py <image_path>
```

**Installing packages:**
```bash
uv pip install <package>
```

**Checking/formatting code:**
```bash
# ✅ ALWAYS format code with Black before committing
uv run black *.py
uv run black dataset_utils.py
uv run black build_warp_dataset.py
uv run black vggt_point_cloud_viewer.py

# Check formatting without modifying
uv run black --check *.py

# Run linting
uv run pylint *.py
```

## Code Formatting with Black

**All Python code in this repository must be formatted with Black.** This is non-negotiable before any commit.

### When to Format

- **Before every commit**: Run `uv run black *.py`
- **On file save**: VS Code auto-formats if Black formatter extension is installed
- **In CI/CD**: Formatting is validated; commits with unformatted code will be rejected

### Black Configuration

Black uses these settings project-wide:
- **Line length**: 88 characters
- **Indentation**: 4 spaces
- **String quotes**: Double quotes (unless single quotes require fewer escapes)
- **Trailing commas**: Added in multi-line constructs

### Examples

```bash
# Format all Python files in repo
uv run black .

# Format specific files
uv run black dataset_utils.py build_warp_dataset.py

# Format with verbose output
uv run black -v dataset_utils.py

# Check what would change without modifying
uv run black --diff dataset_utils.py

# Fail if any file needs formatting (useful for CI)
uv run black --check .
```

## Setting Up Pre-Commit Hooks

To automatically format code before every commit:

```bash
# Install pre-commit framework
uv pip install pre-commit

# Install the git hooks
uv run pre-commit install

# Now formatting happens automatically on commit!
# To manually run checks on all files:
uv run pre-commit run --all-files
```

After setup, pre-commit will:
- ✅ Format code with Black
- ✅ Sort imports with isort
- ✅ Check style with flake8
- ✅ Trim trailing whitespace
- ✅ Fix file endings

If any checks fail on commit, they'll either auto-fix or show errors you need to address.

## VS Code Tasks

You can also run formatting from VS Code:

1. **Command Palette** → `Tasks: Run Task`
2. Select one of these:
   - **Format code with Black** - Formats entire repo
   - **Check formatting with Black** - Shows what would change
   - **Run tests with pytest** - Runs test suite
   - **Lint with pylint** - Runs linter

Or press `Ctrl+Shift+B` to run the default build task (currently set to tests).

## Why `uv`?

This project uses `uv` (a fast Python package installer) to:
- Ensure consistent dependency versions across all developers and CI/CD
- Provide fast, reliable builds
- Manage the Python virtual environment (`.venv/`)

The `uv` tool automatically uses the project's configured virtual environment, ensuring all dependencies are available and correctly isolated.

## When in Doubt

If ever unsure whether to use `uv run`, **default to using it**. It won't hurt and ensures compatibility with the project setup.
